<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Implement navigation</title>
</head>
<body>
<p>With the navigation content types in place, let’s use a view component to render the <em>Navigation menu</em> that exists in the Content hub.</p>
<h2 id="create-view-models">Create view models</h2>
<p>Start by creating view models that correspond to the <em>Navigation item</em> and <em>Navigation menu</em> classes.</p>
<p>Add a new <em>Navigation</em> folder under <em>Kickstart.Web/Features</em>, to hold all the navigation-related files.</p>
<p>Inside, create the <code>NavigationItemViewModel</code>. It only needs two properties - <em>Title</em> and <em>Url</em>.</p>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>NavigationItemViewModel.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
namespace Kickstart.Web.Features.Navigation;
public class NavigationItemViewModel
{
    public string Title { get; set; }

    public string Url { get; set; }
}
</code></pre>
</div>

<p>You might remember that in the <a href="/guides/development/developer-kickstart/build-a-page-template#add-a-view-model-class">page template step</a>, you defined a method that created a <code>LandingPageViewModel</code> based on a <code>LandingPage</code> object.</p>
<p>We need a similar method here to create a <code>NavigationItemViewModel</code> from a <code>NavigationItem</code>.</p>
<p>You can retrieve the page’s URL simply by calling the <code>GetUrl</code> extension method of <code>IWebPageFieldsSource</code>, which every web page implements. Return <code>null</code> if the provided item is <code>null</code> or missing its target.</p>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>NavigationItemViewModel.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
using System.Linq;
using CMS.Websites;
using Microsoft.IdentityModel.Tokens;

namespace Kickstart.Web.Features.Navigation;

public class NavigationItemViewModel
{
    public string Title { get; set; }

    public string Url { get; set; }

    // new method
    public static NavigationItemViewModel GetViewModel(NavigationItem navigationItem)
    {
        if (navigationItem?.NavigationItemTarget?.IsNullOrEmpty() ?? true)
        {
            return null;
        }

        var targetUrl = navigationItem.NavigationItemTarget.FirstOrDefault().GetUrl();

        return new NavigationItemViewModel
        {
            Title = navigationItem.NavigationItemTitle,
            Url = targetUrl.RelativePath
        };
    }
}

</code></pre>
</div>

<p>The <code>NavigationMenuViewModel</code> class also needs two properties: one to represent its <em>Name</em> and another to represent its <em>Items</em>.</p>
<p>Add a static method that returns a menu view model for the provided <code>NavigationMenu</code> object, calling <code>NavigationItemViewModel.GetViewModel</code> from above for each menu item.</p>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>NavigationMenuViewModel.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
using System.Collections.Generic;
using System.Linq;

using Microsoft.IdentityModel.Tokens;

namespace Kickstart.Web.Features.Navigation;

public class NavigationMenuViewModel
{
    public string Name { get; set; }

    public IEnumerable&lt;NavigationItemViewModel&gt; Items { get; set; }

    public static NavigationMenuViewModel GetViewModel(NavigationMenu navigationMenu)
    {
        if (navigationMenu?.NavigationMenuItems?.IsNullOrEmpty() ?? true)
        {
            return null;
        }

        var menuItems = navigationMenu.NavigationMenuItems
            .Select(NavigationItemViewModel.GetViewModel)
            .Where(x =&gt; x != null);

        return new NavigationMenuViewModel
        {
            Name = navigationMenu.NavigationMenuDisplayName,
            Items = menuItems
        };
    }
}
</code></pre>
</div>

<h2 id="define-a-view-component">Define a view component</h2>
<p>Websites often have multiple navigation menus. Let’s make a view component that renders the menu. You can reuse the view component across the site.</p>
<p>Define an asynchronous view component with a string parameter to indicate which menu item to retrieve.</p>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>NavigationMenuViewComponent.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;

namespace Kickstart.Web.Features.Navigation;

public class NavigationMenuViewComponent : ViewComponent
{
    public async Task&lt;IViewComponentResult&gt; InvokeAsync(string navigationMenuCodeName)
    {
        // A placeholder representing the logic that retrieves the `NavigationMenu` item from the database.
        var menu = await RetrieveMenu(navigationMenuCodeName);

        if (menu == null)
        {
            return View("~/Features/Navigation/NavigationMenuViewComponent.cshtml", new NavigationMenuViewModel());
        }

        var model = NavigationMenuViewModel.GetViewModel(menu);
        
        // We will define this view in the next step.
        return View("~/Features/Navigation/NavigationMenuViewComponent.cshtml", model);
    }
}
</code></pre>
</div>


<div>

</div>
<div>
<p>If you copy-paste the code above, you will see a couple of issues:</p>
<ol type="1">
<li>The <code>RetrieveMenu</code> method does not exist - for now, we are using a placeholder to represent the logic that retrieves the menu item from the database.</li>
<li>The <code>~/Features/Navigation/NavigationMenuViewComponent.cshtml</code> view does not exist yet.</li>
</ol>
<p>We will fix both of these shortly.</p>
</div>

<p>Add a private method to retrieve the menu.</p>
<p>To query the content items, we will use the <a href="/documentation/developers-and-admins/api/content-item-api/content-retriever-api">ContentRetriever</a>, as we did in <a href="/guides/development/developer-kickstart/build-a-page-template#query-the-landing-page">the earlier step</a>. This time we’ll use it’s <code>RetrieveContent</code> method to get the whole menu structure, including it’s items, based on a provided menu codename.</p>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>NavigationMenuViewComponent.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
using System.Linq;
using System.Threading.Tasks;
using Kentico.Content.Web.Mvc;
using Microsoft.AspNetCore.Mvc;

namespace Kickstart.Web.Features.Navigation;

public class NavigationMenuViewComponent : ViewComponent
{
    private readonly IContentRetriever contentRetriever;
    // inject the Xperience by Kentico Content retriever service
    public NavigationMenuViewComponent(IContentRetriever contentRetriever) =&gt; this.contentRetriever = contentRetriever;

    public async Task&lt;IViewComponentResult&gt; InvokeAsync(string navigationMenuCodeName)
    {
        var menu = await RetrieveMenu(navigationMenuCodeName);

        if (menu == null)
        {
            return View("~/Features/Navigation/NavigationMenuViewComponent.cshtml", new NavigationMenuViewModel());
        }

        var model = NavigationMenuViewModel.GetViewModel(menu);

        return View("~/Features/Navigation/NavigationMenuViewComponent.cshtml", model);
    }

    // new private method
    private async Task&lt;NavigationMenu&gt; RetrieveMenu(string navigationMenuCodeName)
    {
        // specify the depth of the content item tree we want to get (we need the menu and it's children items) 
        var parameters = new RetrieveContentParameters
        {
            LinkedItemsMaxLevel = 2
        };
        // retrieve the navigation menu object
        var menus = await contentRetriever.RetrieveContent&lt;NavigationMenu&gt;(
            parameters,
            query =&gt; query
                .Where(where =&gt; where.WhereEquals(nameof(NavigationMenu.NavigationMenuCodeName), navigationMenuCodeName)),
            RetrievalCacheSettings.CacheDisabled
            );

        return menus.FirstOrDefault();
    }
}
</code></pre>
</div>

<h2 id="design-the-components-view">Design the component’s view</h2>
<p>Now, we just need a view to render the model provided by <code>NavigationMenuViewComponent</code>.</p>
<p>Add a file called <em>NavigationMenuViewComponent.cshtml</em> that renders a <code>nav</code> element containing a list of links from the model’s <code>Items</code>.</p>

<div>

</div>
<div>
<p>Spice up the design of the menu with some Bootstrap CSS classes.</p>
</div>


<div>
<div>
<div>
<span>cshtml</span>
</div>
<strong>NavigationMenuViewComponent.cshtml</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
@using Kickstart.Web.Features.Navigation

@model NavigationMenuViewModel

@if (Model?.Items?.Any() ?? false)
{
    &lt;nav&gt;
        &lt;ul class="navbar-nav nav-underline"&gt;
            @foreach (var item in Model.Items)
            {
                &lt;li class="nav-item"&gt;
                    &lt;a href="@item.Url" class="nav-link link-light"&gt;@item.Title&lt;/a&gt;
                &lt;/li&gt;
            }
        &lt;/ul&gt;
    &lt;/nav&gt;
}
</code></pre>
</div>

<p>Finally, add the view component to the <em>_Layout.cshtml</em> view beneath the site heading, specifying <em>MainNavigation</em> as the codename of the menu to retrieve. Adjust the Bootstrap CSS classes as necessary.</p>

<div>
<div>
<div>
<span>cshtml</span>
</div>
<strong>_Layout.cshtml</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
...
&lt;div class="navbar navbar-primary navbar-expand-sm navbar-dark bg-primary p-3"&gt;
    &lt;div class="navbar-brand"&gt;
        &lt;h2&gt;Xperience Kickstart&lt;/h2&gt;
    &lt;/div&gt;
    &lt;vc:navigation-menu navigation-menu-code-name="MainNavigation" /&gt;
&lt;/div&gt;
...
</code></pre>
</div>

<p>With all these elements in place, you should have a working navigation menu that looks something like this:</p>
<p></p>

<div>

</div>
<div>
<p>If you haven’t already, check out our <a href="https://github.com/Kentico/xperience-by-kentico-kickstart" target="_blank">Kickstart repository</a> to see the complete implementation of the website we created together in this series. To run the project, follow the <em>README</em> instructions.</p>
</div>

<p>Continue to the next step for additional exercises and resources.</p>
<h2 id="continue-learning">Continue learning</h2>
<p>When you’re ready, move on to the next page: <a href="/guides/development/developer-kickstart/next-steps">Next steps</a></p>

</body>
</html>
