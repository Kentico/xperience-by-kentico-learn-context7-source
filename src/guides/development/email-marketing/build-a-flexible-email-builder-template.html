<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Build a flexible Email Builder template</title>
</head>
<body>
<p>Email Builder in Xperience by Kentico empowers marketers to create visually engaging emails using a drag-and-drop interface. Let’s create a flexible, reusable template that supports a variety of layouts and color schemes.</p>
<p>We’ll walk through the process of building a general-purpose template and section for Email Builder, supporting a range of visual customization options for your marketers.</p>
<p></p>
<h2 id="before-you-start">Before you start</h2>
<p>This guide uses resources from the <a href="https://github.com/Kentico/xperience-by-kentico-email-builder-starter-kit/" target="_blank">Email Builder Starter Kit</a></p>

<div>

</div>
<div>
<p>If you haven’t already integrated the Email Builder Starter Kit into your project, you can see a step-by-step example <a href="/guides/development/email-marketing/use-email-builder-starter-kit">in this guide</a>.</p>
</div>

<p>This guide requires the following:</p>
<ul>
<li>Familiarity with <a href="https://learn.microsoft.com/en-us/dotnet/csharp/" target="_blank">C#</a>, <a href="https://learn.microsoft.com/en-us/dotnet/" target="_blank">.NET Core</a>, <a href="https://learn.microsoft.com/en-us/dotnet/core/extensions/dependency-injection" target="_blank">Dependency injection</a>, and the <a href="https://learn.microsoft.com/en-us/aspnet/core/mvc/overview" target="_blank">MVC pattern</a>.</li>
<li>Familiarity with <a href="/documentation/developers-and-admins/development/builders">builders in Xperience by Kentico</a>, especially <a href="/documentation/developers-and-admins/development/builders/email-builder">Email Builder</a>
</li>
<li>Familiarity with <a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/components/" target="_blank">ASP.NET Razor components</a>, <a href="/documentation/developers-and-admins/development/builders/email-builder/develop-email-builder-components#blazor-development-best-practices">Blazor development best practices</a>, and <a href="/documentation/developers-and-admins/development/builders/email-builder/develop-email-builder-components#mjml-markup">MJML markup</a>.</li>
<li>A running instance of Xperience by Kentico, preferably <a href="/documentation/changelog">30.6.2</a> or higher.

<div>

</div>
<div>
Some features covered in the Training guides may not work in older versions.
</div>
</li>
</ul>

<div>
<p><strong>Code samples</strong></p>
<p>You can find a project with completed, working versions of code samples from this guide and others in the <a href="https://github.com/Kentico/xperience-by-kentico-training-guides/tree/finished" target="_blank">finished branch</a> of the <em>Training guides</em> repository.</p>
<p>The <a href="https://github.com/Kentico/xperience-by-kentico-training-guides" target="_blank">main branch</a> of the repository provides a starting point to code along with the guides.</p>
<p>The code samples in this guide have only been tested in <a href="https://learn.microsoft.com/en-us/dotnet/core/whats-new/dotnet-9/overview" target="_blank">.NET 8</a>.</p>
<p>They come from a project that uses <a href="https://learn.microsoft.com/en-us/dotnet/core/project-sdk/overview#implicit-using-directives" target="_blank">implicit using directives</a>. You may need to add additional <code>using</code> directives to your code if your project does not use this feature.</p>
</div>

<h2 id="prepare-styling-options">Prepare styling options</h2>
<h3 id="create-an-enumeration-dropdown-provider">Create an enumeration dropdown provider</h3>
<p>To support flexible layouts and color schemes, start by creating dropdown providers for enumerations. This allows you to manage the options marketers can specify for column layout, corner style, and color scheme.</p>
<p>You may be familiar with a DropdownEnumOptionProvider class from our <a href="/guides/development/page-builder/map-enum-to-dropdown#implement-a-generic-mapper-class">dropdown provider guide</a>. If your project does not have the class, you add it by following the steps in that guide or copy the completed code from <a href="https://github.com/Kentico/xperience-by-kentico-training-guides/blob/finished/src/TrainingGuides.Web/Features/Shared/OptionProviders/DropdownEnumOptionProvider.cs" target="_blank">the finished branch of the training guides repository.</a>.</p>
<h3 id="define-a-service-for-parsing-enum-values">Define a service for parsing enum values</h3>
<p>Next, create and register a service for parsing enum values from strings, using the <a href="https://www.nuget.org/packages/Enums.NET/" target="_blank">Enums.NET NuGet package</a>. It should take a <em>default value</em> to fall back to when the provided string does not contain an enum value.</p>
<p>We also outline this in the <a href="/guides/development/page-builder/map-enum-to-dropdown#create-a-service-to-parse-enumeration-values-from-strings">dropdown provider guide</a> mentioned earlier, which creates the following files:</p>
<ul>
<li><a href="https://github.com/Kentico/xperience-by-kentico-training-guides/blob/finished/src/TrainingGuides.Web/Features/Shared/OptionProviders/IEnumStringService.cs" target="_blank">~/Features/Shared/OptionProviders/IEnumStringService.cs</a></li>
<li><a href="https://github.com/Kentico/xperience-by-kentico-training-guides/blob/finished/src/TrainingGuides.Web/Features/Shared/OptionProviders/EnumStringService.cs" target="_blank">~/Features/Shared/OptionProviders/EnumStringService.cs</a></li>
<li><a href="https://github.com/Kentico/xperience-by-kentico-training-guides/blob/finished/src/TrainingGuides.Web/ServiceCollectionExtensions.cs" target="_blank">~/ServiceCollectionExtensions.cs</a></li>
</ul>
<h3 id="include-enumerations-for-styling">Include enumerations for styling</h3>
<p>With a dropdown provider and a class for parsing enumeration values in place, we can move on to the enumerations themselves.</p>
<p>If you haven’t completed our or <a href="/guides/development/page-builder">guides</a>, add these files to your project:</p>
<ul>
<li><a href="https://github.com/Kentico/xperience-by-kentico-training-guides/blob/finished/src/TrainingGuides.Web/Features/Shared/OptionProviders/ColorScheme/ColorSchemeOption.cs" target="_blank">~/Features/Shared/OptionProviders/ColorScheme/ColorSchemeOption.cs</a></li>
<li><a href="https://github.com/Kentico/xperience-by-kentico-training-guides/blob/finished/src/TrainingGuides.Web/Features/Shared/OptionProviders/ColumnLayout/ColumnLayoutOption.cs" target="_blank">~/Features/Shared/OptionProviders/ColumnLayout/ColumnLayoutOption.cs</a></li>
<li><a href="https://github.com/Kentico/xperience-by-kentico-training-guides/blob/finished/src/TrainingGuides.Web/Features/Shared/OptionProviders/CornerStyle/CornerStyleOption.cs" target="_blank">~/Features/Shared/OptionProviders/CornerStyle/CornerStyleOption.cs</a></li>
</ul>
<h3 id="add-styles-corresponding-to-the-enums">Add styles corresponding to the enums</h3>
<p>Now we have the framework for allowing editors to specify styling options, but we don’t have any actual styles to apply based on their selections.</p>
<p>Let’s define CSS classes to style your Email Builder components according to the selected options.</p>

<div>
<div>
<div>
<span>CSS</span>
</div>
<strong>~/wwwroot/EmailBuilder.css</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
...
.tg-tiny-margin {
    margin: 1px;
}

.tg-corner-shrp {
    border-radius: 0;
}

.tg-corner-rnd {
    border-radius: 32px;
}

.tg-corner-v-rnd {
    border-radius: 64px;
}

.tg-bg-primary {
    background: #8107c1;
}

.tg-bg-secondary {
    background: #f0561a;
}

.tg-bg-none {
    background: none;
}

.tg-bg-light-1 {
    background: white;
}

.tg-bg-light-2 {
    background: #efe6f9;
}

.tg-bg-light-3 {
    background: #ebf5ff;
}

.tg-txt-light {
    color: white;
}

.tg-txt-light a {
    color: #f0561a;
}

.tg-txt-medium {
    color: #f0561a;
}

.tg-txt-medium a {
    color: white;
}
.tg-txt-dark {
    color: #1e1a1b;
}

.tg-txt-dark a {
    color: #f0561a;
}
</code></pre>
</div>

<h3 id="link-these-styles-to-their-enums-with-a-service">Link these styles to their enums with a service</h3>
<p>Now, all that’s left is to build a service that retrieves a collection of CSS styles based on a provided enumeration value.</p>

<div>

</div>
<div>
<p>The column layout will change the markup of an email, so we’ll handle that logic in the specific Razor component. For this service, focus on retrieving classes for color scheme and corner style, which are controlled by CSS classes.</p>
</div>

<p>Add the following files:</p>
<ul>
<li><a href="https://github.com/Kentico/xperience-by-kentico-training-guides/blob/finished/src/TrainingGuides.Web/Features/Shared/Services/IComponentStyleEnumService.cs" target="_blank">~/Features/Shared/Services/IComponentStyleEnumService.cs</a></li>
<li><a href="https://github.com/Kentico/xperience-by-kentico-training-guides/blob/finished/src/TrainingGuides.Web/Features/Shared/Services/ComponentStyleEnumService.cs" target="_blank">~/Features/Shared/Services/ComponentStyleEnumService.cs</a></li>
<li><a href="https://github.com/Kentico/xperience-by-kentico-training-guides/blob/finished/src/TrainingGuides.Web/ServiceCollectionExtensions.cs" target="_blank">~/ServiceCollectionExtensions.cs</a></li>
</ul>

<div>

</div>
<div>
<p>You can find more implementation details for the style service in the <a href="/guides/development/page-builder/create-versatile-templates-part-1#create-a-service-to-retrieve-styles">versatile page templates guide</a>.</p>
</div>

<h2 id="craft-a-reusable-columns-component">Craft a reusable columns component</h2>
<p>Now, let’s create a Razor component analogous to the <a href="https://github.com/Kentico/xperience-by-kentico-training-guides/blob/finished/src/TrainingGuides.Web/Features/Shared/ViewComponents/PageBuilderColumnsViewComponent.cs" target="_blank">Page Builder columns view component</a> from the .</p>

<div>

</div>
<div>
<p>In this case, we’ll render only widget zones. Allowing the component to conditionally render both editable areas and widget zones, like we did in the Page Builder component, would cause problems with the hierarchy of <a href="https://documentation.mjml.io/#standard-body-components" target="_blank">MJML components</a>.</p>
<p>Alternately, you can modify the component to render editable areas instead. This will require you to take a different approach regarding which level of the Email Builder hierarchy you can use certain MJML elements (templates vs sections vs widgets).</p>
</div>

<h3 id="define-the-models">Define the models</h3>
<p>Add a new folder, <em>~/Features/Shared/EmailBuilder/RazorComponents/</em>, and create models to represent email layout columns.</p>
<p>Start with a model for the individual columns. Each widget zone will need an identifier, and the option to control which widgets are allowed.</p>
<p>Then, the <code>mj-column</code> component that wraps each widget zone will need a width and CSS classes.</p>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>EmailBuilderColumnModel.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
namespace TrainingGuides.Web.Features.Shared.EmailBuilder.RazorComponents;

public class EmailBuilderColumnModel
{
    public int Width { get; set; } = 0;
    public string Identifier { get; set; } = string.Empty;
    public IEnumerable&lt;string&gt; CssClasses { get; set; } = [];
    public IEnumerable&lt;string&gt; AllowedWidgets { get; set; } = [];
    // If you want to apply this approach to Editable Areas rather than Widget Zones, you can also include this:
    // public IEnumerable&lt;string&gt; AllowedSections { get; set; } = [];
}
</code></pre>
</div>

<p>Moving on to the collection of columns, for now let’s just include one property to hold multiple column models.</p>

<div>

</div>
<div>
<p>You can expand this with additional properties in the future, or simply eliminate this class and include the collection of columns directly in the Razor component, depending on your project’s conventions.</p>
</div>


<div>
<div>
<div>
<span>C#</span>
</div>
<strong>EmailBuilderColumnsModel.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
namespace TrainingGuides.Web.Features.Shared.EmailBuilder.RazorComponents;

public class EmailBuilderColumnsModel
{
    public IEnumerable&lt;EmailBuilderColumnModel&gt; Columns { get; set; } = [];
}
</code></pre>
</div>

<h3 id="build-the-component">Build the component</h3>
<p>The component’s code-behind needs the following elements:</p>
<ol type="1">
<li>Constants that it can use for its widget zone identifiers.
<ul>
<li>We’ll follow the zone naming conventions from the <a href="https://github.com/Kentico/xperience-by-kentico-email-builder-starter-kit" target="_blank">Email Builder Starter Kit</a>.</li>
</ul>
</li>
<li>A private <code>EmailBuilderColumnsModel</code> property, to hold information about the columns it needs to render</li>
<li>
<em>(Optional)</em> A dictionary of attributes and properties, to dynamically configure certain properties of its Widget zone</li>
<li>Properties to configure the component’s corner style, column layout, column colors, and allowed widgets</li>
<li>Methods to assemble the columns and populate their properties based on the selected options
<ul>
<li>Let’s specify the width of each column as a percentage, leaving some extra space to compensate for padding.</li>
</ul>
</li>
<li>Calls to the <code>ComponentStyleEnumService</code> to retrieve CSS classes corresponding to each selected color scheme</li>
</ol>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>EmailBuilderColumns.razor.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
using Microsoft.AspNetCore.Components;
using TrainingGuides.Web.Features.Shared.OptionProviders.ColorScheme;
using TrainingGuides.Web.Features.Shared.OptionProviders.ColumnLayout;
using TrainingGuides.Web.Features.Shared.OptionProviders.CornerStyle;
using TrainingGuides.Web.Features.Shared.Services;

namespace TrainingGuides.Web.Features.Shared.EmailBuilder.RazorComponents;

public partial class EmailBuilderColumns : ComponentBase
{
    // If you want to apply this approach to Editable Areas rather than Widget Zones, we recommend changing these constants with more accurate names.
    private const string ZONE_MAIN = "Widget_Zone_0";
    private const string ZONE_SECONDARY = "Widget_Zone_1";
    private const string ZONE_TERTIARY = "Widget_Zone_2";

    private EmailBuilderColumnsModel Model { get; set; } = new();

    private Dictionary&lt;string, object&gt; AreaAttributes { get; set; } = [];

    private int NumberOfColumns =&gt; ColumnLayout switch
    {
        ColumnLayoutOption.TwoColumnEven or
        ColumnLayoutOption.TwoColumnLgSm or
        ColumnLayoutOption.TwoColumnSmLg
        =&gt; 2,
        ColumnLayoutOption.ThreeColumnEven or
        ColumnLayoutOption.ThreeColumnSmLgSm
        =&gt; 3,
        ColumnLayoutOption.OneColumn or
        _
        =&gt; 1
    };

    [Inject]
    private IComponentStyleEnumService ComponentStyleEnumService { get; set; } = default!;

    [Parameter]
    public ColumnLayoutOption ColumnLayout { get; set; } = ColumnLayoutOption.OneColumn;

    [Parameter]
    public CornerStyleOption CornerStyle { get; set; } = CornerStyleOption.Round;

    [Parameter]
    public ColorSchemeOption Column1ColorScheme { get; set; } = ColorSchemeOption.Light1;

    [Parameter]
    public ColorSchemeOption Column2ColorScheme { get; set; } = ColorSchemeOption.Light1;

    [Parameter]
    public ColorSchemeOption Column3ColorScheme { get; set; } = ColorSchemeOption.Light1;

    [Parameter]
    public IEnumerable&lt;string&gt; AllowedWidgets { get; set; } = [];

    // If you want to apply this approach to Editable Areas rather than Widget Zones, you can also include this:
    // [Parameter]
    // public IEnumerable&lt;string&gt; AllowedSections { get; set; } = [];

    protected override void OnInitialized()
    {
        if (AllowedWidgets.Where(str =&gt; !string.IsNullOrWhiteSpace(str)).Any())
            AreaAttributes.Add(nameof(AllowedWidgets), AllowedWidgets);
        // If you want to apply this approach to Editable Areas rather than Widget Zones, you can also include this:
        // if (AllowedSections.Where(str =&gt; !string.IsNullOrWhiteSpace(str)).Any())
        //     AreaAttributes.Add(nameof(AllowedSections), AllowedSections);

        Model = new EmailBuilderColumnsModel
        {
            Columns = GetColumns(),
        };
    }

    private IEnumerable&lt;EmailBuilderColumnModel&gt; GetColumns()
    {
        var columns = new List&lt;EmailBuilderColumnModel&gt;();

        int numberOfColumns = NumberOfColumns;
        for (int i = 0; i &lt; numberOfColumns; i++)
        {
            columns.Add(GetColumn(i));
        }

        return columns;
    }

    private EmailBuilderColumnModel GetColumn(int columnIndex)
    {
        string columnIdentifier;
        int width;
        var cssClasses = GetColumnCssClasses(columnIndex).ToList();
        cssClasses.AddRange(ComponentStyleEnumService.GetCornerStyleClasses(CornerStyle));
        cssClasses.Add("tg-tiny-margin");

        switch (ColumnLayout)
        {
            case ColumnLayoutOption.TwoColumnEven:
                //first column is main
                width = 45;
                columnIdentifier = columnIndex == 0
                    ? ZONE_MAIN
                    : ZONE_SECONDARY;
                break;
            case ColumnLayoutOption.TwoColumnLgSm:
                //first column is main
                if (columnIndex == 0)
                {
                    width = 60;
                    columnIdentifier = ZONE_MAIN;
                }
                else
                {
                    width = 30;
                    columnIdentifier = ZONE_SECONDARY;
                }
                break;
            case ColumnLayoutOption.TwoColumnSmLg:
                //second column is main
                if (columnIndex == 0)
                {
                    width = 30;
                    columnIdentifier = ZONE_SECONDARY;
                }
                else
                {
                    width = 60;
                    columnIdentifier = ZONE_MAIN;
                }
                break;
            case ColumnLayoutOption.ThreeColumnEven:
                //middle column is main
                width = 30;
                columnIdentifier = columnIndex == 1
                    ? ZONE_MAIN
                    : columnIndex == 0
                        ? ZONE_SECONDARY
                        : ZONE_TERTIARY;
                break;
            case ColumnLayoutOption.ThreeColumnSmLgSm:
                if (columnIndex == 1)
                {
                    width = 40;
                    columnIdentifier = ZONE_MAIN;
                }
                else
                {
                    width = 25;
                    columnIdentifier = columnIndex == 0
                        ? ZONE_SECONDARY
                        : ZONE_TERTIARY;
                }
                break;
            case ColumnLayoutOption.OneColumn:
            default:
                //sole column is main
                width = 90;
                columnIdentifier = ZONE_MAIN;
                break;
        }

        return new EmailBuilderColumnModel
        {
            Width = width,
            CssClasses = cssClasses,
            Identifier = columnIdentifier,
            AllowedWidgets = AllowedWidgets,
            // If you want to apply this approach to Editable Areas rather than Widget Zones, you can also include this:
            // AllowedSections = AllowedSections
        };
    }

    private IEnumerable&lt;string&gt; GetColumnCssClasses(int columnIndex) =&gt; columnIndex switch
    {
        0 =&gt; ComponentStyleEnumService.GetColorSchemeClasses(Column1ColorScheme),
        1 =&gt; ComponentStyleEnumService.GetColorSchemeClasses(Column2ColorScheme),
        2 =&gt; ComponentStyleEnumService.GetColorSchemeClasses(Column3ColorScheme),
        _ =&gt; []
    };
}
</code></pre>
</div>

<p>Moving on to the component itself, it can be fairly simple thanks to the work we did in the code-behind.</p>
<p>Display the columns using a foreach loop.</p>
<strong>EmailBuilderColumns.razor</strong>

<div>
<div>
<div>
<span>cshtml</span>
</div>
<strong>EmailBuilderColumns.razor</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
@using Kentico.VisualBuilderComponents.Rcl.Components

@foreach(var column in Model.Columns)
{
    &lt;mj-column width="@($"{column.Width}%")" css-class="@(string.Join(" ", column.CssClasses))" padding="8px"&gt;
        &lt;WidgetZone ZoneName="@(column.Identifier)" @attributes="AreaAttributes" /&gt;
    &lt;/mj-column&gt;
}
</code></pre>
</div>

<h2 id="build-a-general-section">Build a general section</h2>
<p>With the Razor component in place, let’s create a section that utilizes our email builder columns component. Create the <em>~/Features/Shared/EmailBuilder/Sections</em> folder.</p>
<h3 id="define-section-properties.">Define section properties.</h3>
<p>To feed the parameters of our columns component, we need properties that allow editors to choose different layout and styling options.</p>
<p>Add properties for the corner style of the section, and the color scheme of each potential column. Depending on the selected layout, the component will not render certain columns. Let’s use visibility conditions and a configurator to conditionally hide columns in each scenario.</p>
<h4 id="section-properties">Section properties</h4>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>GeneralEmailSectionProperties.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
using Kentico.EmailBuilder.Web.Mvc;
using Kentico.Xperience.Admin.Base.FormAnnotations;
using TrainingGuides.Web.Features.Shared.OptionProviders;
using TrainingGuides.Web.Features.Shared.OptionProviders.ColorScheme;
using TrainingGuides.Web.Features.Shared.OptionProviders.ColumnLayout;
using TrainingGuides.Web.Features.Shared.OptionProviders.CornerStyle;

namespace TrainingGuides.Web.Features.Shared.EmailBuilder.Sections;

public class GeneralEmailSectionProperties : IEmailSectionProperties
{
    [DropDownComponent(
        Label = "Column layout",
        ExplanationText = "Select the layout of the editable areas in the template.",
        DataProviderType = typeof(DropdownEnumOptionProvider&lt;ColumnLayoutOption&gt;),
        Order = 10)]
    public string ColumnLayout { get; set; } = nameof(ColumnLayoutOption.OneColumn);

    [DropDownComponent(
        Label = "Corner type",
        ExplanationText = "Select the corner type of the template.",
        DataProviderType = typeof(DropdownEnumOptionProvider&lt;CornerStyleOption&gt;),
        Order = 20)]
    public string CornerStyle { get; set; } = nameof(CornerStyleOption.Round);

    [DropDownComponent(
        Label = "Column 1 color scheme",
        ExplanationText = "Select the color scheme for the first column.",
        DataProviderType = typeof(DropdownEnumOptionProvider&lt;ColorSchemeOption&gt;),
        Order = 30)]
    public string Column1ColorScheme { get; set; } = nameof(ColorSchemeOption.Light1);

    [DropDownComponent(
        Label = "Column 2 color scheme",
        ExplanationText = "Select the color scheme for the second column.",
        DataProviderType = typeof(DropdownEnumOptionProvider&lt;ColorSchemeOption&gt;),
        Order = 40)]
    // This property is only visible if the layout is not single-column
    [VisibleIfNotEqualTo(nameof(ColumnLayout), nameof(ColumnLayoutOption.OneColumn))]
    public string Column2ColorScheme { get; set; } = nameof(ColorSchemeOption.Light1);

    [DropDownComponent(
        Label = "Column 3 color scheme",
        ExplanationText = "Select the color scheme for the third column.",
        DataProviderType = typeof(DropdownEnumOptionProvider&lt;ColorSchemeOption&gt;),
        Order = 50)]
    // This property is visible if the layout is any of multiple three-column options
    [FormComponentConfiguration(typeof(GeneralEmailSectionColumn3Configurator), [nameof(ColumnLayout)])]
    public string Column3ColorScheme { get; set; } = nameof(ColorSchemeOption.Light1);

}
</code></pre>
</div>

<h4 id="configurator">Configurator</h4>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>GeneralEmailSectionColumn3Configurator.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
using Kentico.Xperience.Admin.Base.Forms;
using TrainingGuides.Web.Features.Shared.OptionProviders;
using TrainingGuides.Web.Features.Shared.OptionProviders.ColumnLayout;
using TrainingGuides.Web.Features.Shared.VisibilityConditions;

namespace TrainingGuides.Web.Features.Shared.EmailBuilder.Sections;

public class GeneralEmailSectionColumn3Configurator : FormComponentConfigurator&lt;DropDownComponent&gt;
{
    private readonly IEnumStringService enumStringService;

    public GeneralEmailSectionColumn3Configurator(IEnumStringService enumStringService)
    {
        this.enumStringService = enumStringService;
    }

    public override async Task Configure(DropDownComponent formComponent, IFormFieldValueProvider formFieldValueProvider, CancellationToken cancellationToken)
    {
        if (!GetShowColumn3(formFieldValueProvider))
        {
            HideField(formComponent);
        }
    }

    private bool GetShowColumn3(IFormFieldValueProvider formFieldValueProvider)
    {
        if (formFieldValueProvider.TryGet(nameof(GeneralEmailSectionProperties.ColumnLayout), out string columnLayout))
        {
            var layout = enumStringService.Parse(columnLayout, ColumnLayoutOption.OneColumn);
            return layout is ColumnLayoutOption.ThreeColumnEven or ColumnLayoutOption.ThreeColumnSmLgSm;
        }
        return true;
    }

    private void HideField(DropDownComponent formComponent) =&gt;
        formComponent.VisibilityConditions.Add(new Invisible());
}
</code></pre>
</div>

<h4 id="custom-visibility-condition-for-configurator">Custom visibility condition for configurator</h4>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>~/Features/Shared/VisibilityConditions/Invisible.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
using Kentico.Xperience.Admin.Base.Forms;

namespace TrainingGuides.Web.Features.Shared.VisibilityConditions;

// Custom visibility condition that is always false, used to dynamically hide fields in configurators
public class Invisible : VisibilityCondition
{
    public override bool Evaluate(IFormFieldValueProvider formFieldValueProvider) =&gt; false;
}
</code></pre>
</div>

<h3 id="define-the-sections-razor-component">Define the section’s Razor component</h3>
<p>Thanks to the <code>EmailBuilderColumns</code> component <a href="#craft-a-reusable-columns-component">we built earlier</a>, the section component can be fairly simple.</p>
<p>In the code-behind, register the component and include a <code>GeneralEmailSectionProperties</code> parameter to access marketers’ configurations. Then utilize the <code>IEnumStringService</code> to parse enumeration values from the properties.</p>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>GeneralEmailSection.razor.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
using Kentico.EmailBuilder.Web.Mvc;
using TrainingGuides.Web.Features.Shared.EmailBuilder.Sections;

using Microsoft.AspNetCore.Components;
using TrainingGuides.Web.Features.Shared.OptionProviders.ColumnLayout;
using TrainingGuides.Web.Features.Shared.OptionProviders.CornerStyle;
using TrainingGuides.Web.Features.Shared.OptionProviders.ColorScheme;
using TrainingGuides.Web.Features.Shared.OptionProviders;

[assembly: RegisterEmailSection(
    identifier: GeneralEmailSection.IDENTIFIER,
    name: "General email template section",
    componentType: typeof(GeneralEmailSection),
    PropertiesType = typeof(GeneralEmailSectionProperties),
    Description = "Section for the General email template.",
    IconClass = "icon-l-cols-3")]

namespace TrainingGuides.Web.Features.Shared.EmailBuilder.Sections;

public partial class GeneralEmailSection : ComponentBase
{
    public const string IDENTIFIER = "TrainingGuides.GeneralEmailSection";

    [Inject]
    private IEnumStringService EnumStringService { get; set; } = default!;

    private ColumnLayoutOption ColumnLayout =&gt; EnumStringService.Parse(Properties.ColumnLayout, ColumnLayoutOption.OneColumn);
    private CornerStyleOption CornerStyle =&gt; EnumStringService.Parse(Properties.CornerStyle, CornerStyleOption.Round);
    private ColorSchemeOption Column1ColorScheme =&gt; 
        EnumStringService.Parse(Properties.Column1ColorScheme, ColorSchemeOption.Light1);
    private ColorSchemeOption Column2ColorScheme =&gt; 
        EnumStringService.Parse(Properties.Column2ColorScheme, ColorSchemeOption.Light1);
    private ColorSchemeOption Column3ColorScheme =&gt; 
        EnumStringService.Parse(Properties.Column3ColorScheme, ColorSchemeOption.Light1);

    [Parameter]
    public GeneralEmailSectionProperties Properties { get; set; } = new();
}
</code></pre>
</div>

<p>In the template’s Razor file, wrap the columns component in a <code>mj-section</code> component, for consistency with the sections from the Email Builder Starter Kit.</p>

<div>

</div>
<div>
<p>Depending on the conventions of your project, you may use different MJML components at different levels. Keep in mind that <strong>MJML has strict guidelines for which components are allowed where</strong>. For example, <code>mj-section</code> cannot nest inside of other <code>mj-section</code> components, or in lower-level components like <code>mj-column</code>.</p>
</div>


<div>
<div>
<div>
<span>cshtml</span>
</div>
<strong>GeneralEmailSection.razor</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
@using Kentico.VisualBuilderComponents.Rcl.Components
@using TrainingGuides.Web.Features.Shared.EmailBuilder.RazorComponents

&lt;mj-section width="600px" padding="8px"&gt;
    &lt;EmailBuilderColumns ColumnLayout="@ColumnLayout" 
        CornerStyle="@CornerStyle"
        Column1ColorScheme="@Column1ColorScheme"
        Column2ColorScheme="@Column2ColorScheme"
        Column3ColorScheme="@Column3ColorScheme" /&gt;
&lt;/mj-section&gt;
</code></pre>
</div>

<h3 id="save-the-component-identifier">Save the component identifier</h3>
<p>If you use a shared component identifiers file in your project, like we do in the “https://github.com/Kentico/xperience-by-kentico-training-guides/tree/finished” linkText=“Training guides repository” %}, you can add the general section’s identifier.</p>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>~/ComponentIdentifiers.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre data-line="7-9"><code>
...
using TrainingGuides.Web.Features.Shared.EmailBuilder.Sections;
...
public static class ComponentIdentifiers
{
    ...
    public static class EmailBuilderSections
    {
        public const string GENERAL = GeneralEmailSection.IDENTIFIER;

        // Kentico.Xperience.Mjml.StarterKit.Rcl sections
        public const string FULL_WIDTH = FullWidthEmailSection.IDENTIFIER;
        public const string TWO_COLUMN = TwoColumnEmailSection.IDENTIFIER;
    }
}
</code></pre>
</div>

<h2 id="create-a-general-template">Create a general template</h2>
<p>With the section in place, we can tie everything together with an Email Builder template.</p>
<p>Create the <em>~/Features/Shared/Emailbuilder/Templates</em> folder to hold files related to the general email template.</p>
<h3 id="define-email-template-properties">Define email template properties</h3>
<p>Specify the template properties. We’ll include properties for the background color and corner shape, and allow multiple, vertically-stacked editable areas.</p>

<div>

</div>
<div>
<p>It’s possible to add rows to a single editable area by adding multiple sections to it.</p>
<p>Using multiple editable areas provides you the option to add contrasting styles for template rows, compared to sections within a single editable area, such as a larger space between. Additionally, it will make it more difficult for marketers to accidentally delete entire rows on templates that are meant to have a minimum number.</p>
<p>You can exclude this functionality if it does not meet your requirements.</p>
</div>


<div>
<div>
<div>
<span>C#</span>
</div>
<strong>GeneralEmailTemplateProperties.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
using Kentico.EmailBuilder.Web.Mvc;
using Kentico.Xperience.Admin.Base.FormAnnotations;
using TrainingGuides.Web.Features.Shared.OptionProviders;
using TrainingGuides.Web.Features.Shared.OptionProviders.ColorScheme;
using TrainingGuides.Web.Features.Shared.OptionProviders.CornerStyle;

namespace TrainingGuides.Web.Features.Shared.EmailBuilder.Templates;

public class GeneralEmailTemplateProperties : IEmailTemplateProperties
{
    [NumberInputComponent(
        Label = "Number of rows",
        ExplanationText = "The number of rows in the template. (maximum of 5)",
        Order = 10)]
    public int NumberOfRows { get; set; } = 1;

    [DropDownComponent(
        Label = "Corner type",
        ExplanationText = "Select the corner type of the template.",
        DataProviderType = typeof(DropdownEnumOptionProvider&lt;CornerStyleOption&gt;),
        Order = 20)]
    public string CornerStyle { get; set; } = nameof(CornerStyleOption.Round);

    [DropDownComponent(
        Label = "Color scheme",
        ExplanationText = "Select the color scheme of the template.",
        DataProviderType = typeof(DropdownEnumOptionProvider&lt;ColorSchemeOption&gt;),
        Order = 30)]
    public string MainColorScheme { get; set; } = nameof(ColorSchemeOption.Light2);
}
</code></pre>
</div>

<p>Now we can move on to the Razor component for the template. The approach for the template’s layout is much simpler than dealing with columns, so there’s no need to break it out into a separate component.</p>
<p>Aside from the layout, we also need to account for information in the header of the email, like styles and metadata, and the unsubscribe link.</p>

<div>

</div>
<div>
<p>Since this template is designed to be content-type agnostic, let’s use <code>EmailContextAccessor.GetContext().EmailFields</code> to access the <em>subject</em> and <em>preview text</em>, which are mandatory for every email content type.</p>
<p>We can move away from this obsolete method in the future when a non-typed alternative for accessing this information exists.</p>
</div>


<div>
<div>
<div>
<span>C#</span>
</div>
<strong>GeneralEmailTemplate.razor.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
using CMS.EmailMarketing;
using Kentico.EmailBuilder.Web.Mvc;
using Kentico.Xperience.Mjml.StarterKit.Rcl;
using Microsoft.AspNetCore.Components;
using TrainingGuides.Web.Features.Shared.OptionProviders;
using TrainingGuides.Web.Features.Shared.OptionProviders.ColorScheme;
using TrainingGuides.Web.Features.Shared.OptionProviders.CornerStyle;
using TrainingGuides.Web.Features.Shared.Services;

namespace TrainingGuides.Web.Features.Shared.EmailBuilder.Templates;

public partial class GeneralEmailTemplate : ComponentBase
{
    public const string IDENTIFIER = "TrainingGuides.GeneralEmailTemplate";

    public const string AREA_MAIN = "MainContent";

    private string Subject { get; set; } = string.Empty;
    private string EmailPreviewText { get; set; } = string.Empty;
    private CornerStyleOption CornerStyle =&gt; EnumStringService.Parse(Properties.CornerStyle, CornerStyleOption.Round);
    private ColorSchemeOption MainColorScheme =&gt; EnumStringService.Parse(Properties.MainColorScheme, ColorSchemeOption.Light2);
    private List&lt;string&gt; RowIdentifiers { get; set; } = [];
    private List&lt;string&gt; MainCssClasses { get; set; } = [];

    private string? cssContent;
    protected string CssContent
    {
        get =&gt; cssContent ?? string.Empty;
        set =&gt; cssContent = value;
    }

    private EmailRecipientContext? recipient;

    protected EmailRecipientContext Recipient =&gt; recipient ??= RecipientContextAccessor.GetContext();

    [Parameter]
    public GeneralEmailTemplateProperties Properties { get; set; } = new();

    [Inject]
    private IEmailRecipientContextAccessor RecipientContextAccessor { get; set; } = default!;

    [Inject]
    private IEmailContextAccessor EmailContextAccessor { get; set; } = default!;

    [Inject]
    private CssLoaderService CssLoaderService { get; set; } = default!;

    [Inject]
    private IComponentStyleEnumService ComponentStyleEnumService { get; set; } = default!;

    [Inject]
    private IEnumStringService EnumStringService { get; set; } = default!;

    protected override async Task OnInitializedAsync()
    {
        Subject = EmailContextAccessor.GetContext().EmailFields.GetValue("Subject") as string ?? string.Empty;
        EmailPreviewText = EmailContextAccessor.GetContext().EmailFields.GetValue("EmailPreviewText") as string ?? string.Empty;
        CssContent = await CssLoaderService.GetCssAsync();

        var cornerCssClasses = ComponentStyleEnumService.GetCornerStyleClasses(CornerStyle);

        MainCssClasses.AddRange(ComponentStyleEnumService.GetColorSchemeClasses(MainColorScheme));
        MainCssClasses.AddRange(cornerCssClasses);

        int numberOfRows = Math.Clamp(Properties.NumberOfRows, 1, 5);
        for (int index = 0; index &lt; numberOfRows; index++)
        {
            string rowIdentifier = index == 0 ? AREA_MAIN : $"Area_{index}";
            RowIdentifiers.Add(rowIdentifier);
        }

    }
}
</code></pre>
</div>


<div>
<div>
<div>
<span>cshtml</span>
</div>
<strong>GeneralEmailTemplate.razor</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
@using Kentico.VisualBuilderComponents.Rcl.Components
@using TrainingGuides.Web
@using TrainingGuides.Web.Features.Shared.EmailBuilder.RazorComponents;
@using TrainingGuides.Web.Features.Shared.OptionProviders.ColumnLayout

&lt;mjml&gt;
  &lt;mj-head&gt;
    &lt;mj-title&gt;@Subject&lt;/mj-title&gt;
    &lt;mj-attributes&gt;
      &lt;mj-all color="inherit" /&gt;
    &lt;/mj-attributes&gt;
    &lt;mj-preview&gt;
      @EmailPreviewText
    &lt;/mj-preview&gt;
    &lt;mj-style&gt;
      @((MarkupString)CssContent)
    &lt;/mj-style&gt;
    &lt;EmailBuilderStyles /&gt;
  &lt;/mj-head&gt;
  &lt;mj-body&gt;
    &lt;mj-wrapper css-class="@(string.Join(" ", MainCssClasses))" &gt;
      @foreach (var rowIdentifier in RowIdentifiers)
      {
        &lt;EditableArea AreaIdentifier="@rowIdentifier" DefaultSectionIdentifier="@ComponentIdentifiers.EmailBuilderSections.GENERAL" AllowedSections="[ComponentIdentifiers.EmailBuilderSections.GENERAL]" /&gt;
      }
      &lt;mj-text align="center"&gt;
        &lt;a href="@Recipient.UnsubscriptionUrl" data-click-tracking="false"&gt;Unsubscribe&lt;/a&gt;
      &lt;/mj-text&gt;
    &lt;/mj-wrapper&gt;
    &lt;EmailBuilderScripts /&gt;
  &lt;/mj-body&gt;
&lt;/mjml&gt;
</code></pre>
</div>

<h3 id="register-the-template">Register the template</h3>
<p>We recommend registering the template in a separate file, in case you want to move the template and section into a more portable RCL or NuGet package.</p>
<p>That way, you can locate the registration attribute outside of the separate project, in a location with access to your solution’s content types.</p>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>~/Features/Shared/EmailBuilder/TrainingGuidesEmailBuilderComponentRegister.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
using Kentico.EmailBuilder.Web.Mvc;
using TrainingGuides;
using TrainingGuides.Web.Features.Shared.EmailBuilder.Templates;

[assembly: RegisterEmailTemplate(
    identifier: GeneralEmailTemplate.IDENTIFIER,
    name: "General email template",
    componentType: typeof(GeneralEmailTemplate),
    PropertiesType = typeof(GeneralEmailTemplateProperties),
    IconClass = "xp-l-rows-3",
    ContentTypeNames = [BasicEmail.CONTENT_TYPE_NAME])]
</code></pre>
</div>

<h2 id="see-the-results">See the results</h2>
<p>Now your new Email Builder components are in working order!</p>
<p>Create a new email using the <em>General email template</em> to test it out!</p>

<p>You can use these components along with widgets from the Email Builder Starter Kit to create an email like this:</p>
<p></p>

<div>

</div>
<div>
<p>Due to current system limitations at the time this guide was authored, the text color on the <strong>Email Builder</strong> tab may not match the color specified in a template or section. The correct color will appear on the <strong>Preview</strong> tab and in the sent email.</p>
<p>Your marketers should consider the <strong>Preview</strong> tab as the <em>source of truth</em>.</p>
</div>


</body>
</html>
