<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Retrieve page URLs</title>
</head>
<body>
<p>Pages in the content tree of Xperience websites can have their live site URLs generated by the system through <a href="/documentation/developers-and-admins/development/routing/content-tree-based-routing">content tree-based routing</a> or <a href="/documentation/business-users/website-content/manage-page-urls">entered by marketers as a vanity URL</a>. This allows content editors to create new pages or adjust the URLs of existing ones in the administration interface, without the need to update and redeploy the application. The final URL returned by the application is the one selected as the <a href="/documentation/business-users/website-content/manage-page-urls#select-the-canonical-url-of-pages">canonical</a> (system URLs by default).</p>
<p>You may need to get the URLs of retrieved pages in various scenarios, such as rendering navigation menus, other page links, performing redirects, etc.</p>
<p>There are two main ways to retrieve page URLs:</p>
<h3 id="using-the-geturl-extension-method">Using the GetUrl extension method</h3>
<p>This method is available for <a href="/documentation/developers-and-admins/api/generate-code-files-for-system-objects">generated model classes</a> and in general for objects that implement <a href="/documentation/developers-and-admins/api/generate-code-files-for-system-objects#icontentitemfieldssource-interfaces">IWebPageFieldsSource</a>. It returns a <code>WebPageUrl</code> object containing the relative and absolute URL for a page.</p>
<p>A key advantage of <code>GetUrl()</code> is that it <strong>never results in additional database queries</strong>. If the necessary data for URL resolution is missing from the retrieved page object, it terminates with an exception instead. In its internal implementation, the method relies solely on the data prefetched by a content query call. The necessary URL data is included by default through the <code>IncludeUrlPath</code> property of the parameters object when using the <a href="/documentation/developers-and-admins/api/content-item-api/reference-content-retriever-api#page-query-parameters">IContentRetriever</a> API.</p>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>Retrieve the URL of a page using GetUrl()</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
// Services obtained via dependency injection
private readonly IContentRetriever contentRetriever;

public async Task PageUrlRetrieval()
{
    // Retrieve pages using IContentRetriever (recommended approach)
    var articles = await contentRetriever.RetrievePages&lt;ArticlePage&gt;()

    var articlePage = articles.FirstOrDefault();
    if (articlePage != null)
    {
        // Retrieves URL data for the page
        WebPageUrl url = articlePage.GetUrl();

        string relativePath = url.RelativePath;
        string absoluteUrl = url.AbsoluteUrl;
    }
}
</code></pre>
</div>

<p>If you are <a href="/documentation/developers-and-admins/api/content-item-api/content-retriever-api#optimizing-retrieved-data-for-url-generation">optimizing data retrieval for URL generation</a> using the <code>IContentRetriever</code> or retrieving data using the <a href="/documentation/developers-and-admins/api/content-item-api/content-item-query-api">content item query API</a> with custom configuration that might exclude URL columns, use the <code>UrlPathColumns()</code> method to ensure the selected columns include URL data.</p>
<h3 id="using-the-iwebpageurlretriever-interface">Using the IWebPageUrlRetriever interface</h3>
<p>This interface (available in the <code>CMS.Websites</code> namespace) offers more specialized URL retrieval options, particularly when you only have the page identifier or need to retrieve a URL for a page object that might not have all URL-related data pre-loaded. Unlike <code>GetUrl()</code>, <code>IWebPageUrlRetriever</code> may perform additional database queries if the necessary information isn’t available in the provided page object or if only a page identifier is supplied.</p>
<p>URLs resolved using the service respect the <a href="#url-language-behavior">URL language behavior</a> set when retrieving the data – it constructs the resulting URLs in the desired language format.</p>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>Retrieve the URL of a page using IWebPageUrlRetriever</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>

// An instance of IWebPageUrlReriever 
// (e.g., obtained via dependency injection)
private readonly IWebPageUrlRetriever webPageUrlRetriever;

// A page retrieved using the content query
ArticlePage article;

// Id of a web page retrieved previously
int webPageItemId;

// Retrieves URL data of a page in a specific language 
// using the whole page and language code
WebPageUrl url1 = await webPageUrlRetriever.Retrieve(article, "en");
string url1_relative = url1.RelativePath;
string url1_absolute = url1.AbsoluteUrl;

// Retrieves URL data of a page in a specific language 
// using the page id and language code
WebPageUrl url2 = await webPageUrlRetriever.Retrieve(webPageItemId, "en");
string url2_relative = url2.RelativePath;
string url2_absolute = url2.AbsoluteUrl;

</code></pre>
</div>

<h2 id="url-language-behavior">URL language behavior</h2>
<p>When retrieving URLs in <a href="/documentation/developers-and-admins/configuration/languages">multilingual scenarios</a>, you can control the language of the generated URL path using the <code>UrlLanguageBehavior</code> enum:</p>
<ul>
<li>
<code>UseRequestedLanguage</code> – When a page is served in a <a href="/documentation/developers-and-admins/configuration/languages#language-fallbacks">fallback language</a>, its URL path is generated based on the language originally requested by the retrieval method. For instance, if Spanish is requested and an English page is returned as a fallback, the URL path will still be structured as if it were a Spanish page (e.g., using URL prefixes as configured in the <a href="/documentation/developers-and-admins/configuration/languages#set-up-a-new-language">Languages</a> application).</li>
<li>
<code>UseFallbackLanguage</code> – When a page is served in a fallback language, its URL path is generated based on the language of the actual fallback content. In the example below, the URL path would be structured as an English page.</li>
</ul>
<p>By default, the <a href="/documentation/developers-and-admins/api/content-item-api/content-retriever-api#controlling-url-language-with-fallbacks">ContentRetriever API</a> implements the <code>UseRequestedLanguage</code> behavior, while the <a href="/documentation/developers-and-admins/api/content-item-api/reference-content-item-query#seturllanguagebehavior">content item query API</a> implements <code>UseFallbackLanguage</code>. In both cases, you can configure the behavior to suit your needs by using the <code>SetUrlLanguageBehavior</code> method when building queries.</p>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>Configure IContentRetriever URL language behavior for a query using GetUrl</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>
//  Instance of the IContentRetriever service obtained via dependency injection
private readonly IContentRetriever contentRetriever;

public async Task PageRetrievalWithCustomUrlLanguage()
{
    var pages = await contentRetriever.RetrievePages&lt;ArticlePage&gt;(
        new RetrievePagesParameters { LanguageName = "es" },
        query =&gt; query.SetUrlLanguageBehavior(UrlLanguageBehavior.UseFallbackLanguage),
        new RetrievalCacheSettings(cacheItemNameSuffix:
                                        $"{nameof(RetrievePagesQueryParameters.SetUrlLanguageBehavior)}|UseFallbackLanguage")
    );

    foreach(var page in pages)
    {
        // If a page requested in Spanish uses English content
        // due to language fallback, its URL will use the 'english'
        // language segments due to 'UrlLanguageBehavior.UseFallbackLanguage'.
        //
        // For example: '/&lt;spanishLanguageName&gt;/my-page-slug'
        WebPageUrl url = page.GetUrl();
    }
}
</code></pre>
</div>

<h2 id="url-formatting-and-behavior">URL formatting and behavior</h2>
<p>Retrieved URLs are always returned in lower case without a trailing slash. You can modify some behavior of retrieved URLs using the following options and the <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/configuration/options?view=aspnetcore-8.0" target="_blank">.NET options pattern</a>:</p>
<ul>
<li>
<code>WebPageUrlRetrieverOptions</code> – Allows you to change the cache duration. The URLs are by default cached for 24 hours.</li>
<li>
<code>UrlResolveOptions</code> – Allows you to specify whether SSL protocol should be included when retrieving absolute URLs. By default, <code>https</code> URLs are returned.</li>
</ul>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong>Program.cs</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>

var builder = WebApplication.CreateBuilder(args);

// ...

// Sets the cache duration to 60 minutes
builder.Services.Configure&lt;WebPageUrlRetrieverOptions&gt;(
    options =&gt; options.MaximumUrlCacheDuration = TimeSpan.FromMinutes(60));
// Includes SSL in absolute URLs
builder.Services.Configure&lt;UrlResolveOptions&gt;(
    options =&gt; options.UseSSL = false);

</code></pre>
</div>

<p>The relative path to a page returned by the <code>Retrieve</code> method can be resolved to an application absolute path at runtime (for example, using the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.web.mvc.urlhelper.content?view=aspnet-mvc-5.2" target="_blank">UrlHelper.Content</a> method).</p>

<div>
<div>
<div>
<span>cshtml</span>
</div>
<strong>Resolve relative URLs in Razor</strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>

@using Microsoft.AspNetCore.Mvc

&lt;!-- 
    Relative URL of the article is passed through 
    the AricleUrl model property 
--&gt;
&lt;a href="@Url.Content(Model.ArticleUrl)"&gt;Visit the Article!&lt;/a&gt;

</code></pre>
</div>


</body>
</html>
