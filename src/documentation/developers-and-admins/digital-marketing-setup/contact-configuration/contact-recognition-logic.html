<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Contact recognition logic</title>
</head>
<body>
<p>On <a href="/documentation/developers-and-admins/configuration/website-channel-management">websites</a>, Xperience stores the current <a href="/documentation/business-users/digital-marketing/contact-management">contact</a> persistently in the <strong>CurrentContact</strong> browser cookie. For visitors without the cookie, new anonymous contacts are always created and remain in the system unless they are automatically merged with an existing contact. Merging occurs if the <strong>email address</strong> value of the contact is updated and matches the address of an existing contact.</p>
<p>The system remembers contacts until their cookies are deleted or until a different contact is determined for the visitor.</p>
<p>On many websites, different people often connect from the same IP addresses (e.g., from company or municipal networks). To keep contacts separate in such scenarios, Xperience does NOT automatically assign contacts to anonymous visitors based on their <em>IP address</em> or <em>Browser user agent</em>.</p>
<h3 id="contact-email-collisions">Contact email collisions</h3>
<p>Because a contact’s email address is its main identifier in Xperience, the system does not allow the email to be changed based on data submitted by users. This can happen in the following ways:</p>
<ul>
<li><a href="/documentation/business-users/digital-marketing/forms/create-and-edit-forms#map-form-submission-to-contact-attributes">Form submissions</a></li>
<li><a href="/documentation/developers-and-admins/digital-marketing-setup/headless-tracking#log-activities">Headless tracking Data input activities</a></li>
<li><a href="/documentation/developers-and-admins/digital-marketing-setup/cross-site-tracking#data-input">Cross-site tracking Data input activities</a></li>
</ul>
<p>If the contact associated with a user already has an email address stored in Xperience, and it doesn’t match the newly submitted email value, all related activities and field updates are performed for a different contact. Either an existing contact that matches the submitted email value is used, or a new contact is created. In these cases, the user’s associated contact remains unchanged, but any subsequent actions, such as <a href="/documentation/business-users/digital-marketing/automation">automation processes</a>, are performed for the “other” contact that matches the submitted email address.</p>
<h3 id="customize-contact-recognition">Customize contact recognition</h3>
<p>If the contact recognition logic described above does not suit your needs, developers can change it programmatically by creating and registering a custom implementation of the <code>ICurrentContactProvider</code> service:</p>
<ol type="1">
<li><p>Open your Xperience project in Visual Studio.</p></li>
<li><p><a href="/documentation/developers-and-admins/customization/integrate-custom-code">Add a custom assembly</a> (<em>Class Library</em> project) to the solution or re-use an existing one.</p></li>
<li><p>Create a class that implements the <code>ICurrentContactProvider</code> interface in the custom assembly.</p></li>
<li>
<p>Implement your own logic for contact recognition.</p>

<div>
<div>
<div>
<span>C#</span>
</div>
<strong></strong>
</div>
<div>
<button>
<span></span><span></span> <span>Copy</span>
</button>
</div>
</div>
<div>
<pre><code>

 using System;

 using CMS;
 using CMS.Membership;
 using CMS.ContactManagement;

 [assembly: RegisterImplementation(typeof(ICurrentContactProvider), typeof(CustomCurrentContactProvider))]

 /// &lt;summary&gt;
 /// Summary description for CustomCurrentContactProvider
 /// &lt;/summary&gt;
 public class CustomCurrentContactProvider : ICurrentContactProvider
 {
     public ContactInfo GetCurrentContact(IUserInfo currentUser, bool forceUserMatching)
     {
         // Implement your contact recognition logic
         throw new NotImplementedException();
     }

     public ContactInfo GetExistingContact(IUserInfo currentUser, bool forceUserMatching)
     {
         // Implement your contact recognition logic
         throw new NotImplementedException();
     }

     public void SetCurrentContact(ContactInfo contact)
     {
         // Implement your logic for storing information about the current contact
         throw new NotImplementedException();
     }
 }

 </code></pre>
</div>
</li>
<li><p>Register your service using the <code>RegisterImplementation</code> assembly attribute.</p></li>
</ol>

</body>
</html>
